import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as Q,g as Y,r as Je,i as Tt,a as lt,b as Pt,c as Ft,u as Le,d as Ee,e as Mt,f as Bt,h as B,j as Ut,k as Nt,l as ee,m as _t,v as dt,n as ut,o as _e,p as ft,q as Rt,t as Ot,w as Gt,x as zt,y as Vt,z as jt,A as Re,B as Wt,C as qt,D as Kt,E as Jt,F as Xe}from"./accounts-YaHucQfM.js";import{parseOtpauthURI as Xt}from"./uri-parser-CbsR1lsV.js";const Qt=t=>{const e=new ArrayBuffer(8),s=new Uint8Array(e);let n=t;for(let i=7;i>=0&&n!==0;i--)s[i]=n&255,n-=s[i],n/=256;return s};function Yt(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ae(t,e=""){if(!Number.isSafeInteger(t)||t<0){const s=e&&`"${e}" `;throw new Error(`${s}expected integer >= 0, got ${t}`)}}function ne(t,e,s=""){const n=Yt(t),i=t?.length,o=e!==void 0;if(!n||o&&i!==e){const a=s&&`"${s}" `,c=o?` of length ${e}`:"",l=n?`length=${i}`:`type=${typeof t}`;throw new Error(a+"expected Uint8Array"+c+", got "+l)}return t}function Zt(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash must wrapped by utils.createHasher");Ae(t.outputLen),Ae(t.blockLen)}function ie(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ht(t,e){ne(t,void 0,"digestInto() output");const s=e.outputLen;if(t.length<s)throw new Error('"digestInto() output" expected to be of length >='+s)}function es(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function T(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Fe(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function H(t,e){return t<<32-e|t>>>e}function Me(t,e){return t<<e|t>>>32-e>>>0}const ts=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ss(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function ns(t){for(let e=0;e<t.length;e++)t[e]=ss(t[e]);return t}const Qe=ts?t=>t:ns;function oe(t,e={}){const s=(i,o)=>t(o).update(i).digest(),n=t(void 0);return s.outputLen=n.outputLen,s.blockLen=n.blockLen,s.create=i=>t(i),Object.assign(s,e),Object.freeze(s)}const K=t=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,t])});class pt{update(e){return ie(this),this.iHash.update(e),this}digestInto(e){ie(this),ne(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:s,iHash:n,finished:i,destroyed:o,blockLen:a,outputLen:c}=this;return e=e,e.finished=i,e.destroyed=o,e.blockLen=a,e.outputLen=c,e.oHash=s._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}constructor(e,s){if(this.finished=!1,this.destroyed=!1,Zt(e),ne(s,void 0,"key"),this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,i=new Uint8Array(n);i.set(s.length>n?e.create().update(s).digest():s);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),T(i)}}const Be=(t,e,s)=>new pt(t,e).update(s).digest();Be.create=(t,e)=>new pt(t,e);function gt(t,e,s){return t&e^~t&s}function mt(t,e,s){return t&e^t&s^e&s}class Oe{update(e){ie(this),ne(e);const{view:s,buffer:n,blockLen:i}=this,o=e.length;for(let a=0;a<o;){const c=Math.min(i-this.pos,o-a);if(c===i){const l=Fe(e);for(;i<=o-a;a+=i)this.process(l,a);continue}n.set(e.subarray(a,a+c),this.pos),this.pos+=c,a+=c,this.pos===i&&(this.process(s,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ie(this),ht(e,this),this.finished=!0;const{buffer:s,view:n,blockLen:i,isLE:o}=this;let{pos:a}=this;s[a++]=128,T(this.buffer.subarray(a)),this.padOffset>i-a&&(this.process(n,0),a=0);for(let d=a;d<i;d++)s[d]=0;n.setBigUint64(i-8,BigInt(this.length*8),o),this.process(n,0);const c=Fe(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const f=l/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<f;d++)c.setUint32(4*d,u[d],o)}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const n=e.slice(0,s);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:s,buffer:n,length:i,finished:o,destroyed:a,pos:c}=this;return e.destroyed=a,e.finished=o,e.length=i,e.pos=c,i%s&&e.buffer.set(n),e}clone(){return this._cloneInto()}constructor(e,s,n,i){this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=s,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Fe(this.buffer)}}const _=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),R=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),A=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),k=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),le=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),O=new Uint32Array(80);class is extends Oe{get(){const{A:e,B:s,C:n,D:i,E:o}=this;return[e,s,n,i,o]}set(e,s,n,i,o){this.A=e|0,this.B=s|0,this.C=n|0,this.D=i|0,this.E=o|0}process(e,s){for(let l=0;l<16;l++,s+=4)O[l]=e.getUint32(s,!1);for(let l=16;l<80;l++)O[l]=Me(O[l-3]^O[l-8]^O[l-14]^O[l-16],1);let{A:n,B:i,C:o,D:a,E:c}=this;for(let l=0;l<80;l++){let f,u;l<20?(f=gt(i,o,a),u=1518500249):l<40?(f=i^o^a,u=1859775393):l<60?(f=mt(i,o,a),u=2400959708):(f=i^o^a,u=3395469782);const d=Me(n,5)+f+c+u+O[l]|0;c=a,a=o,o=Me(i,30),i=n,n=d}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,a=a+this.D|0,c=c+this.E|0,this.set(n,i,o,a,c)}roundClean(){T(O)}destroy(){this.set(0,0,0,0,0),T(this.buffer)}constructor(){super(64,20,8,!1),this.A=le[0]|0,this.B=le[1]|0,this.C=le[2]|0,this.D=le[3]|0,this.E=le[4]|0}}const rs=oe(()=>new is),be=BigInt(2**32-1),Ye=BigInt(32);function os(t,e=!1){return e?{h:Number(t&be),l:Number(t>>Ye&be)}:{h:Number(t>>Ye&be)|0,l:Number(t&be)|0}}function bt(t,e=!1){const s=t.length;let n=new Uint32Array(s),i=new Uint32Array(s);for(let o=0;o<s;o++){const{h:a,l:c}=os(t[o],e);[n[o],i[o]]=[a,c]}return[n,i]}const Ze=(t,e,s)=>t>>>s,et=(t,e,s)=>t<<32-s|e>>>s,te=(t,e,s)=>t>>>s|e<<32-s,se=(t,e,s)=>t<<32-s|e>>>s,ve=(t,e,s)=>t<<64-s|e>>>s-32,ye=(t,e,s)=>t>>>s-32|e<<64-s,as=(t,e,s)=>t<<s|e>>>32-s,cs=(t,e,s)=>e<<s|t>>>32-s,ls=(t,e,s)=>e<<s-32|t>>>64-s,ds=(t,e,s)=>t<<s-32|e>>>64-s;function M(t,e,s,n){const i=(e>>>0)+(n>>>0);return{h:t+s+(i/2**32|0)|0,l:i|0}}const us=(t,e,s)=>(t>>>0)+(e>>>0)+(s>>>0),fs=(t,e,s,n)=>e+s+n+(t/2**32|0)|0,hs=(t,e,s,n)=>(t>>>0)+(e>>>0)+(s>>>0)+(n>>>0),ps=(t,e,s,n,i)=>e+s+n+i+(t/2**32|0)|0,gs=(t,e,s,n,i)=>(t>>>0)+(e>>>0)+(s>>>0)+(n>>>0)+(i>>>0),ms=(t,e,s,n,i,o)=>e+s+n+i+o+(t/2**32|0)|0,bs=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),G=new Uint32Array(64);class vt extends Oe{get(){const{A:e,B:s,C:n,D:i,E:o,F:a,G:c,H:l}=this;return[e,s,n,i,o,a,c,l]}set(e,s,n,i,o,a,c,l){this.A=e|0,this.B=s|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=a|0,this.G=c|0,this.H=l|0}process(e,s){for(let d=0;d<16;d++,s+=4)G[d]=e.getUint32(s,!1);for(let d=16;d<64;d++){const m=G[d-15],g=G[d-2],v=H(m,7)^H(m,18)^m>>>3,x=H(g,17)^H(g,19)^g>>>10;G[d]=x+G[d-7]+v+G[d-16]|0}let{A:n,B:i,C:o,D:a,E:c,F:l,G:f,H:u}=this;for(let d=0;d<64;d++){const m=H(c,6)^H(c,11)^H(c,25),g=u+m+gt(c,l,f)+bs[d]+G[d]|0,x=(H(n,2)^H(n,13)^H(n,22))+mt(n,i,o)|0;u=f,f=l,l=c,c=a+g|0,a=o,o=i,i=n,n=g+x|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,a=a+this.D|0,c=c+this.E|0,l=l+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(n,i,o,a,c,l,f,u)}roundClean(){T(G)}destroy(){this.set(0,0,0,0,0,0,0,0),T(this.buffer)}constructor(e){super(64,e,8,!1)}}class vs extends vt{constructor(){super(32),this.A=_[0]|0,this.B=_[1]|0,this.C=_[2]|0,this.D=_[3]|0,this.E=_[4]|0,this.F=_[5]|0,this.G=_[6]|0,this.H=_[7]|0}}class ys extends vt{constructor(){super(28),this.A=R[0]|0,this.B=R[1]|0,this.C=R[2]|0,this.D=R[3]|0,this.E=R[4]|0,this.F=R[5]|0,this.G=R[6]|0,this.H=R[7]|0}}const yt=bt(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ws=yt[0],xs=yt[1],z=new Uint32Array(80),V=new Uint32Array(80);class wt extends Oe{get(){const{Ah:e,Al:s,Bh:n,Bl:i,Ch:o,Cl:a,Dh:c,Dl:l,Eh:f,El:u,Fh:d,Fl:m,Gh:g,Gl:v,Hh:x,Hl:D}=this;return[e,s,n,i,o,a,c,l,f,u,d,m,g,v,x,D]}set(e,s,n,i,o,a,c,l,f,u,d,m,g,v,x,D){this.Ah=e|0,this.Al=s|0,this.Bh=n|0,this.Bl=i|0,this.Ch=o|0,this.Cl=a|0,this.Dh=c|0,this.Dl=l|0,this.Eh=f|0,this.El=u|0,this.Fh=d|0,this.Fl=m|0,this.Gh=g|0,this.Gl=v|0,this.Hh=x|0,this.Hl=D|0}process(e,s){for(let w=0;w<16;w++,s+=4)z[w]=e.getUint32(s),V[w]=e.getUint32(s+=4);for(let w=16;w<80;w++){const U=z[w-15]|0,N=V[w-15]|0,He=te(U,N,1)^te(U,N,8)^Ze(U,N,7),$e=se(U,N,1)^se(U,N,8)^et(U,N,7),P=z[w-2]|0,F=V[w-2]|0,ge=te(P,F,19)^ve(P,F,61)^Ze(P,F,6),Te=se(P,F,19)^ye(P,F,61)^et(P,F,6),me=hs($e,Te,V[w-7],V[w-16]),Pe=ps(me,He,ge,z[w-7],z[w-16]);z[w]=Pe|0,V[w]=me|0}let{Ah:n,Al:i,Bh:o,Bl:a,Ch:c,Cl:l,Dh:f,Dl:u,Eh:d,El:m,Fh:g,Fl:v,Gh:x,Gl:D,Hh:ae,Hl:ce}=this;for(let w=0;w<80;w++){const U=te(d,m,14)^te(d,m,18)^ve(d,m,41),N=se(d,m,14)^se(d,m,18)^ye(d,m,41),He=d&g^~d&x,$e=m&v^~m&D,P=gs(ce,N,$e,xs[w],V[w]),F=ms(P,ae,U,He,ws[w],z[w]),ge=P|0,Te=te(n,i,28)^ve(n,i,34)^ve(n,i,39),me=se(n,i,28)^ye(n,i,34)^ye(n,i,39),Pe=n&o^n&c^o&c,$t=i&a^i&l^a&l;ae=x|0,ce=D|0,x=g|0,D=v|0,g=d|0,v=m|0,{h:d,l:m}=M(f|0,u|0,F|0,ge|0),f=c|0,u=l|0,c=o|0,l=a|0,o=n|0,a=i|0;const Ke=us(ge,me,$t);n=fs(Ke,F,Te,Pe),i=Ke|0}({h:n,l:i}=M(this.Ah|0,this.Al|0,n|0,i|0)),{h:o,l:a}=M(this.Bh|0,this.Bl|0,o|0,a|0),{h:c,l}=M(this.Ch|0,this.Cl|0,c|0,l|0),{h:f,l:u}=M(this.Dh|0,this.Dl|0,f|0,u|0),{h:d,l:m}=M(this.Eh|0,this.El|0,d|0,m|0),{h:g,l:v}=M(this.Fh|0,this.Fl|0,g|0,v|0),{h:x,l:D}=M(this.Gh|0,this.Gl|0,x|0,D|0),{h:ae,l:ce}=M(this.Hh|0,this.Hl|0,ae|0,ce|0),this.set(n,i,o,a,c,l,f,u,d,m,g,v,x,D,ae,ce)}roundClean(){T(z,V)}destroy(){T(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}constructor(e){super(128,e,16,!1)}}class Ls extends wt{constructor(){super(64),this.Ah=k[0]|0,this.Al=k[1]|0,this.Bh=k[2]|0,this.Bl=k[3]|0,this.Ch=k[4]|0,this.Cl=k[5]|0,this.Dh=k[6]|0,this.Dl=k[7]|0,this.Eh=k[8]|0,this.El=k[9]|0,this.Fh=k[10]|0,this.Fl=k[11]|0,this.Gh=k[12]|0,this.Gl=k[13]|0,this.Hh=k[14]|0,this.Hl=k[15]|0}}class Es extends wt{constructor(){super(48),this.Ah=A[0]|0,this.Al=A[1]|0,this.Bh=A[2]|0,this.Bl=A[3]|0,this.Ch=A[4]|0,this.Cl=A[5]|0,this.Dh=A[6]|0,this.Dl=A[7]|0,this.Eh=A[8]|0,this.El=A[9]|0,this.Fh=A[10]|0,this.Fl=A[11]|0,this.Gh=A[12]|0,this.Gl=A[13]|0,this.Hh=A[14]|0,this.Hl=A[15]|0}}const As=oe(()=>new vs,K(1)),ks=oe(()=>new ys,K(4)),Ss=oe(()=>new Ls,K(3)),Cs=oe(()=>new Es,K(2)),Is=BigInt(0),de=BigInt(1),Ds=BigInt(2),Hs=BigInt(7),$s=BigInt(256),Ts=BigInt(113),xt=[],Lt=[],Et=[];for(let t=0,e=de,s=1,n=0;t<24;t++){[s,n]=[n,(2*s+3*n)%5],xt.push(2*(5*n+s)),Lt.push((t+1)*(t+2)/2%64);let i=Is;for(let o=0;o<7;o++)e=(e<<de^(e>>Hs)*Ts)%$s,e&Ds&&(i^=de<<(de<<BigInt(o))-de);Et.push(i)}const At=bt(Et,!0),Ps=At[0],Fs=At[1],tt=(t,e,s)=>s>32?ls(t,e,s):as(t,e,s),st=(t,e,s)=>s>32?ds(t,e,s):cs(t,e,s);function Ms(t,e=24){const s=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let a=0;a<10;a++)s[a]=t[a]^t[a+10]^t[a+20]^t[a+30]^t[a+40];for(let a=0;a<10;a+=2){const c=(a+8)%10,l=(a+2)%10,f=s[l],u=s[l+1],d=tt(f,u,1)^s[c],m=st(f,u,1)^s[c+1];for(let g=0;g<50;g+=10)t[a+g]^=d,t[a+g+1]^=m}let i=t[2],o=t[3];for(let a=0;a<24;a++){const c=Lt[a],l=tt(i,o,c),f=st(i,o,c),u=xt[a];i=t[u],o=t[u+1],t[u]=l,t[u+1]=f}for(let a=0;a<50;a+=10){for(let c=0;c<10;c++)s[c]=t[a+c];for(let c=0;c<10;c++)t[a+c]^=~s[(c+2)%10]&s[(c+4)%10]}t[0]^=Ps[n],t[1]^=Fs[n]}T(s)}class Ge{clone(){return this._cloneInto()}keccak(){Qe(this.state32),Ms(this.state32,this.rounds),Qe(this.state32),this.posOut=0,this.pos=0}update(e){ie(this),ne(e);const{blockLen:s,state:n}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);for(let c=0;c<a;c++)n[this.pos++]^=e[o++];this.pos===s&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:s,pos:n,blockLen:i}=this;e[n]^=s,(s&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){ie(this,!1),ne(e),this.finish();const s=this.state,{blockLen:n}=this;for(let i=0,o=e.length;i<o;){this.posOut>=n&&this.keccak();const a=Math.min(n-this.posOut,o-i);e.set(s.subarray(this.posOut,this.posOut+a),i),this.posOut+=a,i+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ae(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(ht(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,T(this.state)}_cloneInto(e){const{blockLen:s,suffix:n,outputLen:i,rounds:o,enableXOF:a}=this;return e||(e=new Ge(s,n,i,a,o)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=o,e.suffix=n,e.outputLen=i,e.enableXOF=a,e.destroyed=this.destroyed,e}constructor(e,s,n,i=!1,o=24){if(this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=s,this.outputLen=n,this.enableXOF=i,this.rounds=o,Ae(n,"outputLen"),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=es(this.state)}}const Ce=(t,e,s,n={})=>oe(()=>new Ge(e,t,s),n),Bs=Ce(6,144,28,K(7)),Us=Ce(6,136,32,K(8)),Ns=Ce(6,104,48,K(9)),_s=Ce(6,72,64,K(10)),re=(()=>{if(typeof globalThis=="object")return globalThis;Object.defineProperty(Object.prototype,"__GLOBALTHIS__",{get(){return this},configurable:!0});try{if(typeof __GLOBALTHIS__<"u")return __GLOBALTHIS__}finally{delete Object.prototype.__GLOBALTHIS__}if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global})(),nt={SHA1:rs,SHA224:ks,SHA256:As,SHA384:Cs,SHA512:Ss,"SHA3-224":Bs,"SHA3-256":Us,"SHA3-384":Ns,"SHA3-512":_s},ze=t=>{switch(!0){case/^(?:SHA-?1|SSL3-SHA1)$/i.test(t):return"SHA1";case/^SHA(?:2?-)?224$/i.test(t):return"SHA224";case/^SHA(?:2?-)?256$/i.test(t):return"SHA256";case/^SHA(?:2?-)?384$/i.test(t):return"SHA384";case/^SHA(?:2?-)?512$/i.test(t):return"SHA512";case/^SHA3-224$/i.test(t):return"SHA3-224";case/^SHA3-256$/i.test(t):return"SHA3-256";case/^SHA3-384$/i.test(t):return"SHA3-384";case/^SHA3-512$/i.test(t):return"SHA3-512";default:throw new TypeError(`Unknown hash algorithm: ${t}`)}},it=(t,e,s)=>{if(Be){const n=nt[t]??nt[ze(t)];return Be(n,e,s)}else throw new Error("Missing HMAC function")},Ue="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",Rs=t=>{t=t.replace(/ /g,"");let e=t.length;for(;t[e-1]==="=";)--e;t=(e<t.length?t.substring(0,e):t).toUpperCase();const s=new ArrayBuffer(t.length*5/8|0),n=new Uint8Array(s);let i=0,o=0,a=0;for(let c=0;c<t.length;c++){const l=Ue.indexOf(t[c]);if(l===-1)throw new TypeError(`Invalid character found: ${t[c]}`);o=o<<5|l,i+=5,i>=8&&(i-=8,n[a++]=o>>>i)}return n},Os=t=>{let e=0,s=0,n="";for(let i=0;i<t.length;i++)for(s=s<<8|t[i],e+=8;e>=5;)n+=Ue[s>>>e-5&31],e-=5;return e>0&&(n+=Ue[s<<5-e&31]),n},Gs=t=>{t=t.replace(/ /g,"");const e=new ArrayBuffer(t.length/2),s=new Uint8Array(e);for(let n=0;n<t.length;n+=2)s[n/2]=parseInt(t.substring(n,n+2),16);return s},zs=t=>{let e="";for(let s=0;s<t.length;s++){const n=t[s].toString(16);n.length===1&&(e+="0"),e+=n}return e.toUpperCase()},Vs=t=>{const e=new ArrayBuffer(t.length),s=new Uint8Array(e);for(let n=0;n<t.length;n++)s[n]=t.charCodeAt(n)&255;return s},js=t=>{let e="";for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return e},rt=re.TextEncoder?new re.TextEncoder:null,ot=re.TextDecoder?new re.TextDecoder:null,Ws=t=>{if(!rt)throw new Error("Encoding API not available");return rt.encode(t)},qs=t=>{if(!ot)throw new Error("Encoding API not available");return ot.decode(t)},Ks=t=>{if(re.crypto?.getRandomValues)return re.crypto.getRandomValues(new Uint8Array(t));throw new Error("Cryptography API not available")};class ${static fromLatin1(e){return new $({buffer:Vs(e).buffer})}static fromUTF8(e){return new $({buffer:Ws(e).buffer})}static fromBase32(e){return new $({buffer:Rs(e).buffer})}static fromHex(e){return new $({buffer:Gs(e).buffer})}get buffer(){return this.bytes.buffer}get latin1(){return Object.defineProperty(this,"latin1",{enumerable:!0,writable:!1,configurable:!1,value:js(this.bytes)}),this.latin1}get utf8(){return Object.defineProperty(this,"utf8",{enumerable:!0,writable:!1,configurable:!1,value:qs(this.bytes)}),this.utf8}get base32(){return Object.defineProperty(this,"base32",{enumerable:!0,writable:!1,configurable:!1,value:Os(this.bytes)}),this.base32}get hex(){return Object.defineProperty(this,"hex",{enumerable:!0,writable:!1,configurable:!1,value:zs(this.bytes)}),this.hex}constructor({buffer:e,size:s=20}={}){this.bytes=typeof e>"u"?Ks(s):new Uint8Array(e),Object.defineProperty(this,"bytes",{enumerable:!0,writable:!1,configurable:!1,value:this.bytes})}}const Js=(t,e)=>{{if(t.length!==e.length)throw new TypeError("Input strings must have the same length");let s=-1,n=0;for(;++s<t.length;)n|=t.charCodeAt(s)^e.charCodeAt(s);return n===0}};class E{static get defaults(){return{issuer:"",label:"OTPAuth",issuerInLabel:!0,algorithm:"SHA1",digits:6,counter:0,window:1}}static generate({secret:e,algorithm:s=E.defaults.algorithm,digits:n=E.defaults.digits,counter:i=E.defaults.counter,hmac:o=it}){const a=Qt(i),c=o(s,e.bytes,a);if(!c?.byteLength||c.byteLength<19)throw new TypeError("Return value must be at least 19 bytes");const l=c[c.byteLength-1]&15;return(((c[l]&127)<<24|(c[l+1]&255)<<16|(c[l+2]&255)<<8|c[l+3]&255)%10**n).toString().padStart(n,"0")}generate({counter:e=this.counter++}={}){return E.generate({secret:this.secret,algorithm:this.algorithm,digits:this.digits,counter:e,hmac:this.hmac})}static validate({token:e,secret:s,algorithm:n,digits:i=E.defaults.digits,counter:o=E.defaults.counter,window:a=E.defaults.window,hmac:c=it}){if(e.length!==i)return null;let l=null;const f=u=>{const d=E.generate({secret:s,algorithm:n,digits:i,counter:u,hmac:c});Js(e,d)&&(l=u-o)};f(o);for(let u=1;u<=a&&l===null&&(f(o-u),!(l!==null||(f(o+u),l!==null)));++u);return l}validate({token:e,counter:s=this.counter,window:n}){return E.validate({token:e,secret:this.secret,algorithm:this.algorithm,digits:this.digits,counter:s,window:n,hmac:this.hmac})}toString(){const e=encodeURIComponent;return`otpauth://hotp/${this.issuer.length>0?this.issuerInLabel?`${e(this.issuer)}:${e(this.label)}?issuer=${e(this.issuer)}&`:`${e(this.label)}?issuer=${e(this.issuer)}&`:`${e(this.label)}?`}secret=${e(this.secret.base32)}&algorithm=${e(this.algorithm)}&digits=${e(this.digits)}&counter=${e(this.counter)}`}constructor({issuer:e=E.defaults.issuer,label:s=E.defaults.label,issuerInLabel:n=E.defaults.issuerInLabel,secret:i=new $,algorithm:o=E.defaults.algorithm,digits:a=E.defaults.digits,counter:c=E.defaults.counter,hmac:l}={}){this.issuer=e,this.label=s,this.issuerInLabel=n,this.secret=typeof i=="string"?$.fromBase32(i):i,this.algorithm=l?o:ze(o),this.digits=a,this.counter=c,this.hmac=l}}class L{static get defaults(){return{issuer:"",label:"OTPAuth",issuerInLabel:!0,algorithm:"SHA1",digits:6,period:30,window:1}}static counter({period:e=L.defaults.period,timestamp:s=Date.now()}={}){return Math.floor(s/1e3/e)}counter({timestamp:e=Date.now()}={}){return L.counter({period:this.period,timestamp:e})}static remaining({period:e=L.defaults.period,timestamp:s=Date.now()}={}){return e*1e3-s%(e*1e3)}remaining({timestamp:e=Date.now()}={}){return L.remaining({period:this.period,timestamp:e})}static generate({secret:e,algorithm:s,digits:n,period:i=L.defaults.period,timestamp:o=Date.now(),hmac:a}){return E.generate({secret:e,algorithm:s,digits:n,counter:L.counter({period:i,timestamp:o}),hmac:a})}generate({timestamp:e=Date.now()}={}){return L.generate({secret:this.secret,algorithm:this.algorithm,digits:this.digits,period:this.period,timestamp:e,hmac:this.hmac})}static validate({token:e,secret:s,algorithm:n,digits:i,period:o=L.defaults.period,timestamp:a=Date.now(),window:c,hmac:l}){return E.validate({token:e,secret:s,algorithm:n,digits:i,counter:L.counter({period:o,timestamp:a}),window:c,hmac:l})}validate({token:e,timestamp:s,window:n}){return L.validate({token:e,secret:this.secret,algorithm:this.algorithm,digits:this.digits,period:this.period,timestamp:s,window:n,hmac:this.hmac})}toString(){const e=encodeURIComponent;return`otpauth://totp/${this.issuer.length>0?this.issuerInLabel?`${e(this.issuer)}:${e(this.label)}?issuer=${e(this.issuer)}&`:`${e(this.label)}?issuer=${e(this.issuer)}&`:`${e(this.label)}?`}secret=${e(this.secret.base32)}&algorithm=${e(this.algorithm)}&digits=${e(this.digits)}&period=${e(this.period)}`}constructor({issuer:e=L.defaults.issuer,label:s=L.defaults.label,issuerInLabel:n=L.defaults.issuerInLabel,secret:i=new $,algorithm:o=L.defaults.algorithm,digits:a=L.defaults.digits,period:c=L.defaults.period,hmac:l}={}){this.issuer=e,this.label=s,this.issuerInLabel=n,this.secret=typeof i=="string"?$.fromBase32(i):i,this.algorithm=l?o:ze(o),this.digits=a,this.period=c,this.hmac=l}}async function Xs(t,e={}){const{digits:s=6,period:n=30,algorithm:i="SHA1"}=e,o=t.replace(/\s/g,"").toUpperCase();if(!ke(o))throw new Error("Invalid Base32 secret key");try{return new L({secret:$.fromBase32(o),digits:s,period:n,algorithm:i}).generate()}catch(a){throw console.error("[TOTP] Generation error:",a),new Error("Failed to generate TOTP code: "+a.message)}}function Qs(t=30){return t-Math.floor(Date.now()/1e3)%t}function Ys(t){return t?t.length===6?`${t.slice(0,3)} ${t.slice(3)}`:t.length===8?`${t.slice(0,4)} ${t.slice(4)}`:t:"--- ---"}function ke(t){if(!t||typeof t!="string")return!1;const e=t.toUpperCase().replace(/\s/g,"").replace(/=+$/,"");return/^[A-Z2-7]+$/.test(e)&&e.length>=8}const Zs="https://www.googleapis.com/oauth2/v2/userinfo",he="googleAuthToken",Ie="googleUserProfile",en="861059574565-2lnjskhsb0s00c1g6fepv7s5kd6veqcs.apps.googleusercontent.com",tn=["openid","email","profile","https://www.googleapis.com/auth/drive.file"];async function Ve(){const t=await Y(he),e=await Y(Ie);return!!(t&&e)}async function sn(){return await Y(Ie)}async function De(){return await Y(he)}async function nn(t=!0){try{return await new Promise((s,n)=>{chrome.identity.getAuthToken({interactive:t},i=>{chrome.runtime.lastError?n(new Error(chrome.runtime.lastError.message)):i?s(i):n(new Error("No token received"))})})}catch(e){if(console.log("[Google Auth] getAuthToken failed, trying launchWebAuthFlow:",e.message),!t)throw e;return await rn()}}async function rn(){const t=`https://${chrome.runtime.id}.chromiumapp.org/`,e=Math.random().toString(36).substring(2,15),s=new URL("https://accounts.google.com/o/oauth2/v2/auth");return s.searchParams.set("client_id",en),s.searchParams.set("response_type","token"),s.searchParams.set("redirect_uri",t),s.searchParams.set("scope",tn.join(" ")),s.searchParams.set("state",e),s.searchParams.set("prompt","consent"),new Promise((n,i)=>{chrome.identity.launchWebAuthFlow({url:s.toString(),interactive:!0},o=>{if(chrome.runtime.lastError){i(new Error(chrome.runtime.lastError.message));return}if(!o){i(new Error("No redirect URL received"));return}const a=o.split("#")[1];if(!a){i(new Error("No hash in redirect URL"));return}const c=new URLSearchParams(a),l=c.get("access_token"),f=c.get("state");if(!l){const u=c.get("error");i(new Error(u||"No access token in response"));return}if(f!==e){i(new Error("State mismatch - possible CSRF attack"));return}n(l)})})}async function on(){try{const t=await nn(!0);await Q(he,t);const e=await cn(t);if(!e)throw new Error("Failed to fetch user profile");return await Q(Ie,e),{success:!0,user:e}}catch(t){return console.error("[Google Auth] Login failed:",t),{success:!1,error:t.message}}}async function an(){try{const t=await Y(he);if(t){await new Promise(e=>{chrome.identity.removeCachedAuthToken({token:t},e)});try{await fetch(`https://accounts.google.com/o/oauth2/revoke?token=${t}`,{method:"GET"})}catch{}}return await Je(he),await Je(Ie),{success:!0}}catch(t){return console.error("[Google Auth] Logout failed:",t),{success:!1,error:t.message}}}async function cn(t){try{const e=await fetch(Zs,{headers:{Authorization:`Bearer ${t}`,Accept:"application/json"}});if(!e.ok)throw new Error(`HTTP ${e.status}`);const s=await e.json();return{name:s.name||"Google User",email:s.email||"",picture:s.picture||null,id:s.id||""}}catch(e){return console.error("[Google Auth] Fetch profile failed:",e),null}}const ln="https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",je="https://www.googleapis.com/drive/v3/files";async function dn(t,e=null){try{const s=await De();if(!s)return{success:!1,error:"Not authenticated with Google"};const n=new Date().toISOString().slice(0,19).replace(/[:T]/g,"-"),i=e||`azkura-backup-${n}.json`,o={app:"azkura-auth",version:chrome.runtime.getManifest().version,exportedAt:new Date().toISOString(),accountCount:t.length,accounts:t},a=JSON.stringify(o,null,2),c="-------314159265358979323846",l=`\r
--${c}\r
`,f=`\r
--${c}--`,u={name:i,mimeType:"application/json",description:"Azkura Auth Backup - TOTP Authenticator Data"},d=l+`Content-Type: application/json; charset=UTF-8\r
\r
`+JSON.stringify(u)+l+`Content-Type: application/json\r
\r
`+a+f,m=await fetch(ln,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":`multipart/related; boundary="${c}"`},body:d});if(!m.ok){const v=await m.json().catch(()=>({}));throw new Error(v.error?.message||`HTTP ${m.status}`)}return{success:!0,fileId:(await m.json()).id,fileName:i}}catch(s){return console.error("[Google Drive] Upload failed:",s),{success:!1,error:s.message||"Failed to upload backup"}}}async function un(t=10){try{const e=await De();if(!e)return{success:!1,error:"Not authenticated with Google"};const s=encodeURIComponent("name contains 'azkura-backup' and mimeType = 'application/json' and trashed = false"),n=`${je}?q=${s}&pageSize=${t}&orderBy=createdTime desc&fields=files(id,name,createdTime,size)`,i=await fetch(n,{method:"GET",headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});if(!i.ok)throw new Error(`HTTP ${i.status}`);return{success:!0,files:(await i.json()).files||[]}}catch(e){return console.error("[Google Drive] List backups failed:",e),{success:!1,error:e.message}}}async function fn(t){try{const e=await De();if(!e)return{success:!1,error:"Not authenticated with Google"};const s=`${je}/${t}?alt=media`,n=await fetch(s,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!n.ok)throw new Error(`HTTP ${n.status}`);const i=await n.text(),o=JSON.parse(i);if(o.app!=="azkura-auth"||!Array.isArray(o.accounts))throw new Error("Invalid backup file format");return{success:!0,data:o}}catch(e){return console.error("[Google Drive] Download failed:",e),{success:!1,error:e.message}}}async function hn(t){try{const e=await De();if(!e)return{success:!1,error:"Not authenticated with Google"};const s=`${je}/${t}`,n=await fetch(s,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}});if(!n.ok&&n.status!==204)throw new Error(`HTTP ${n.status}`);return{success:!0}}catch(e){return console.error("[Google Drive] Delete failed:",e),{success:!1,error:e.message}}}let S=null,fe=null,y=[],b={},j=null,we=null,J="all",kt=[];const r=t=>document.querySelector(t),W=t=>document.querySelectorAll(t);function q(t){W(".view").forEach(e=>e.classList.remove("active")),r(t).classList.add("active")}function I(t){r(t).classList.add("open")}function p(t){r(t).classList.remove("open")}function h(t,e="info",s=2500){const n=r("#toastContainer"),i={success:"‚úì",error:"‚úï",info:"‚Ñπ"},o=document.createElement("div");o.className=`toast ${e}`,o.innerHTML=`<span class="toast-icon">${i[e]||"‚Ñπ"}</span><span class="toast-text">${t}</span>`,n.appendChild(o),setTimeout(()=>{o.classList.add("out"),setTimeout(()=>o.remove(),400)},s)}function Ne(t,e,s,n){const i=r(`#${t}`),o=r(`#${e}`),a=n?r(`#${n}`):null;let c="";const l=6,f=["1","2","3","4","5","6","7","8","9","","0","‚å´"],u={2:"ABC",3:"DEF",4:"GHI",5:"JKL",6:"MNO",7:"PQRS",8:"TUV",9:"WXYZ",0:"+"};i.innerHTML="",f.forEach(g=>{const v=document.createElement("button");if(v.className="pin-key",!g){v.style.visibility="hidden",i.appendChild(v);return}v.innerHTML=`<span>${g}</span>${u[g]?`<span class="pin-key-sub">${u[g]}</span>`:""}`,v.addEventListener("click",()=>{g==="‚å´"?c=c.slice(0,-1):c.length<l&&(c+=g),d(),c.length===l&&setTimeout(()=>{s(c),c="",d()},80)}),i.appendChild(v)});function d(){o.querySelectorAll(".pin-dot").forEach((v,x)=>{v.classList.toggle("filled",x<c.length),v.classList.remove("error")}),a&&a.classList.remove("visible")}function m(g){c="",d();const v=o.querySelectorAll(".pin-dot");v.forEach(x=>x.classList.add("error")),a&&g&&(a.textContent=g,a.classList.add("visible")),setTimeout(()=>v.forEach(x=>x.classList.remove("error")),600)}return{flashError:m}}function St(){const t=r("#onboardStep1"),e=r("#onboardStep2"),s=r("#onboardStep3");function n(o){["#step1dot","#step2dot","#step3dot"].forEach((a,c)=>{const l=r(a);l.classList.remove("active","done"),c+1===o&&l.classList.add("active"),c+1<o&&l.classList.add("done")})}r("#btnOnboardStart").addEventListener("click",()=>{t.style.display="none",e.style.display="flex",n(2)}),r("#btnBackToWelcome").addEventListener("click",()=>{e.style.display="none",t.style.display="flex",n(1),we=null}),r("#btnSkipPin").addEventListener("click",async()=>{await Ee(!1),S=null,await Le(null),q("#viewMain"),await Se(),h("PIN skipped. You can enable it later in Settings.","info",3e3)}),Ne("pinKeypadCreate","pinDotsCreate",o=>{we=o,e.style.display="none",s.style.display="flex",n(3)},"pinCreateError");const{flashError:i}=Ne("pinKeypadConfirm","pinDotsConfirm",async o=>{if(o!==we){i("PINs do not match. Try again."),we=null,setTimeout(()=>{s.style.display="none",e.style.display="flex",n(2)},700);return}const a=await _e(o);await Q("pinData",a),await Ee(!0),S=o,await Le(o).catch(()=>{}),n(3),q("#viewMain"),await Se()},"pinConfirmError")}function pn(){const{flashError:t}=Ne("pinKeypadLock","pinDotsLock",async e=>{try{const s=await Y("pinData");if(!await dt(e,s.hash,s.salt)){t("Incorrect PIN. Try again.");return}S=e,await Le(e),q("#viewMain"),await Se(),We()}catch{t("Unlock failed. Try again.")}},"pinLockError")}function We(){const t=b.autoLockMinutes;!t||t===0||chrome.alarms.create("auto-lock",{delayInMinutes:t})}function pe(){b.autoLockMinutes&&b.autoLockMinutes>0&&chrome.alarms.create("auto-lock",{delayInMinutes:b.autoLockMinutes})}function X(){document.documentElement.style.setProperty("--accent",b.accentColor||"#00E5FF");const t=b.accentColor||"#00E5FF";document.documentElement.style.setProperty("--accent-dim",`${t}26`),document.documentElement.style.setProperty("--accent-dim2",`${t}14`),document.documentElement.style.setProperty("--border-accent",`${t}4D`),document.getElementById("app").classList.toggle("privacy-mode",!!b.privacyMode),document.getElementById("app").classList.toggle("layout-compact",!!b.compactLayout);const e=r("#privacyModeToggle"),s=r("#compactLayoutToggle"),n=r("#closeAfterCopyToggle"),i=r("#autoFocusSearchToggle"),o=r("#autoLockSelect"),a=r("#pinProtectionToggle");e&&(e.checked=!!b.privacyMode),s&&(s.checked=!!b.compactLayout),n&&(n.checked=b.closeAfterCopy!==!1),i&&(i.checked=b.autoFocusSearch!==!1),o&&(o.value=String(b.autoLockMinutes??5)),a&&(a.checked=!!b.pinEnabled),W("#accentColorPicker .color-swatch").forEach(c=>{c.classList.toggle("active",c.dataset.color===t)}),gn()}function gn(){const t=b.pinEnabled,e=r("#btnChangePIN"),s=r("#autoLockItem"),n=r("#pinDisabledWarning");e&&(e.style.display=t?"flex":"none"),s&&(s.style.display=t?"flex":"none"),n&&(n.style.display=t?"none":"flex")}function mn(t){const i=2*Math.PI*14.5,o=document.createElement("div");return o.className="progress-ring",o.innerHTML=`
    <svg width="32" height="32" viewBox="0 0 32 32">
      <circle class="progress-ring-track" cx="${32/2}" cy="${32/2}" r="${14.5}" stroke-width="3"/>
      <circle class="progress-ring-fill" cx="${32/2}" cy="${32/2}" r="${14.5}" stroke-width="3"
        stroke-dasharray="${i}" stroke-dashoffset="${i}" stroke="var(--totp-normal)"/>
    </svg>
    <div class="progress-ring-text">30</div>
  `,o._circumference=i,o._period=t,o}function bn(t,e,s){const n=t.querySelector(".progress-ring-fill"),i=t.querySelector(".progress-ring-text"),o=t._circumference,a=e/s,c=o*(1-a);n.style.strokeDashoffset=c;let l,f;e>10?(l="var(--totp-normal)",f=""):e>5?(l="var(--totp-warning)",f="warning"):(l="var(--totp-danger)",f="danger"),n.style.stroke=l,i.textContent=e,i.className=`progress-ring-text ${f}`}function vn(t){const e=Wt(t.issuer),s=document.createElement("div");s.className="account-card",s.dataset.id=t.id;const n=document.createElement("div");if(n.className="service-icon",n.style.background=e.bg,e.hasLogo&&e.svg)n.innerHTML=e.svg,n.classList.add("has-logo");else if(e.emoji)n.textContent=e.emoji;else{const u=document.createElement("span");u.className="service-icon-letter",u.textContent=(t.issuer||t.account||"?")[0].toUpperCase(),n.appendChild(u)}const i=document.createElement("div");i.className="account-info",i.innerHTML=`
    <div class="account-issuer">${Z(t.issuer||"Unknown")}</div>
    <div class="account-label">${Z(t.account||"")}</div>
  `;const o=document.createElement("div");o.className="account-code-wrapper";const a=document.createElement("div");a.className="account-code",a.textContent="--- ---";const c=mn(t.period||30);o.appendChild(a),o.appendChild(c);const l=document.createElement("div");l.className="copy-flash";const f=document.createElement("div");return f.className="card-actions",f.innerHTML=`
    <button class="card-action-btn" data-action="folder" title="Move to folder">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
    </button>
    <button class="card-action-btn" data-action="edit" title="Edit">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
    </button>
    <button class="card-action-btn delete" data-action="delete" title="Delete">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>
    </button>
  `,s.appendChild(n),s.appendChild(i),s.appendChild(o),s.appendChild(l),s.appendChild(f),s.addEventListener("click",u=>{u.target.closest("[data-action]")||yn(t.id,a,l,s)}),f.addEventListener("click",u=>{const d=u.target.closest("[data-action]");d&&(u.stopPropagation(),d.dataset.action==="folder"&&Bn(t.id),d.dataset.action==="edit"&&kn(t.id),d.dataset.action==="delete"&&Cn(t.id,t.issuer,t.account))}),s._codeEl=a,s._ringEl=c,s._account=t,s}function Z(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}async function yn(t,e,s,n){const i=e.textContent.replace(/\s/g,"");try{await navigator.clipboard.writeText(i),s.classList.remove("animate"),s.offsetWidth,s.classList.add("animate"),n.classList.add("copied"),setTimeout(()=>n.classList.remove("copied"),800),h("Code copied!","success",1500),pe(),b.closeAfterCopy&&setTimeout(()=>window.close(),700)}catch{h("Failed to copy","error")}}async function Se(){b=await jt(),X(),await Dt(),await qe(),y=await B(),C(y),wn(),b.autoFocusSearch&&setTimeout(()=>r("#searchInput")?.focus(),100),await xe()}function C(t){const e=r("#accountsList");e.innerHTML="";let s=t;if(J==="uncategorized"?s=t.filter(n=>!n.folderId):J!=="all"&&(s=t.filter(n=>n.folderId===J)),!s||s.length===0){const n=r("#searchInput")?.value||"",i=J==="all"?"":J==="uncategorized"?" in Uncategorized":" in this folder";e.innerHTML=`
      <div class="accounts-empty">
        <div class="accounts-empty-icon">${n?"üîç":"üîê"}</div>
        <div class="accounts-empty-title">${n?"No results":"No accounts"}</div>
        <div class="accounts-empty-sub">${n?`No accounts match "${Z(n)}"`:`No accounts${i} yet`}</div>
      </div>
    `;return}s.forEach(n=>{const i=vn(n);e.appendChild(i)}),Ct()}async function Ct(){const t=W(".account-card");for(const e of t){const s=e._account;if(!s)continue;const n=Qs(s.period||30);try{const i=await Xs(s.secret,{digits:s.digits||6,period:s.period||30,algorithm:s.algorithm||"SHA1"});e._codeEl.textContent=Ys(i),e._codeEl.classList.remove("warning","danger"),n<=5?e._codeEl.classList.add("danger"):n<=10&&e._codeEl.classList.add("warning"),bn(e._ringEl,n,s.period||30)}catch{e._codeEl.textContent="Error"}}}function wn(){fe&&clearInterval(fe),fe=setInterval(Ct,1e3)}function xn(){const t=r("#searchInput"),e=r("#searchClear");t.addEventListener("input",async()=>{const s=t.value.trim();e.classList.toggle("visible",s.length>0);const n=await Mt(s);C(n),pe()}),e.addEventListener("click",()=>{t.value="",e.classList.remove("visible"),C(y),t.focus()})}function Ln(){const t=r("#fabBtn"),e=r("#fabMenu");t.addEventListener("click",()=>{const s=e.classList.toggle("open");t.classList.toggle("open",s)}),document.addEventListener("click",s=>{s.target.closest("#fabContainer")||(e.classList.remove("open"),t.classList.remove("open"))}),r("#btnManualEntry").addEventListener("click",()=>{e.classList.remove("open"),t.classList.remove("open"),It(),I("#modalAddAccount")}),r("#btnUploadQR").addEventListener("click",()=>{e.classList.remove("open"),t.classList.remove("open"),chrome.tabs.create({url:chrome.runtime.getURL("src/scanner/scanner.html?tab=upload")})}),r("#btnScanQR").addEventListener("click",()=>{e.classList.remove("open"),t.classList.remove("open"),chrome.tabs.create({url:chrome.runtime.getURL("src/scanner/scanner.html")})})}function En(t){r("#addIssuer").value=t.issuer||"",r("#addAccount").value=t.account||"",r("#addSecret").value=t.secret||"",r("#addAlgorithm").value=t.algorithm||"SHA1",r("#addDigits").value=String(t.digits||6),r("#addPeriod").value=String(t.period||30)}function It(){r("#addIssuer").value="",r("#addAccount").value="",r("#addSecret").value="",r("#addAlgorithm").value="SHA1",r("#addDigits").value="6",r("#addPeriod").value="30",r("#addSecretError").classList.remove("visible")}function An(){r("#closeModalAdd").addEventListener("click",()=>p("#modalAddAccount")),r("#modalAddAccount").addEventListener("click",t=>{t.target===t.currentTarget&&p("#modalAddAccount")}),r("#addSecret").addEventListener("blur",()=>{const t=r("#addSecret").value,e=r("#addSecretError");t&&!ke(t)?(r("#addSecret").classList.add("error"),e.classList.add("visible")):(r("#addSecret").classList.remove("error"),e.classList.remove("visible"))}),r("#btnAddAccountSubmit").addEventListener("click",async()=>{const t=r("#addIssuer").value.trim(),e=r("#addAccount").value.trim(),s=r("#addSecret").value.trim(),n=r("#addAlgorithm").value,i=parseInt(r("#addDigits").value),o=parseInt(r("#addPeriod").value);if(!s||!ke(s)){r("#addSecret").classList.add("error"),r("#addSecretError").classList.add("visible");return}if(!e&&!t){h("Please enter an account name or issuer","error");return}try{r("#btnAddAccountSubmit").disabled=!0;const a=await Bt({issuer:t,account:e,secret:s,algorithm:n,digits:i,period:o},S);y=await B(),C(y),p("#modalAddAccount"),It(),h(`${t||e} added!`,"success"),pe()}catch(a){h("Failed to add account: "+a.message,"error")}finally{r("#btnAddAccountSubmit").disabled=!1}})}function kn(t){const e=y.find(s=>s.id===t);e&&(r("#editAccountId").value=e.id,r("#editIssuer").value=e.issuer||"",r("#editAccountName").value=e.account||"",r("#editSecret").value=e.secret||"",r("#editAlgorithm").value=e.algorithm||"SHA1",r("#editDigits").value=String(e.digits||6),I("#modalEditAccount"))}function Sn(){r("#closeModalEdit").addEventListener("click",()=>p("#modalEditAccount")),r("#modalEditAccount").addEventListener("click",t=>{t.target===t.currentTarget&&p("#modalEditAccount")}),r("#toggleSecretVisibility").addEventListener("click",()=>{const t=r("#editSecret");t.type=t.type==="password"?"text":"password"}),r("#btnEditAccountSubmit").addEventListener("click",async()=>{const t=r("#editAccountId").value,e=r("#editIssuer").value.trim(),s=r("#editAccountName").value.trim(),n=r("#editSecret").value.trim(),i=r("#editAlgorithm").value,o=parseInt(r("#editDigits").value);if(!n||!ke(n)){h("Invalid secret key","error");return}try{r("#btnEditAccountSubmit").disabled=!0,await Ut(t,{issuer:e,account:s,secret:n,algorithm:i,digits:o},S),y=await B(),C(y),p("#modalEditAccount"),h("Account updated!","success"),pe()}catch(a){h("Failed to update: "+a.message,"error")}finally{r("#btnEditAccountSubmit").disabled=!1}})}let ue=null;function Cn(t,e,s){ue=t;const n=`Delete <strong>${Z(e||s)}</strong>? This will permanently remove the account and its TOTP secret.`;r("#deleteConfirmText").innerHTML=n,r("#deleteAccountId").value=t,I("#modalDeleteConfirm")}function In(){r("#btnDeleteCancel").addEventListener("click",()=>{p("#modalDeleteConfirm"),ue=null}),r("#modalDeleteConfirm").addEventListener("click",t=>{t.target===t.currentTarget&&p("#modalDeleteConfirm")}),r("#btnDeleteConfirm").addEventListener("click",async()=>{if(ue)try{await Nt(ue,S),y=await B(),C(y),p("#modalDeleteConfirm"),h("Account deleted","info"),ue=null,pe()}catch(t){h("Failed to delete: "+t.message,"error")}})}function Dn(){const t=r("#btnProfile"),e=r("#profileMenuOverlay");t.addEventListener("click",()=>{e.classList.toggle("open")&&xe()}),e.addEventListener("click",s=>{s.target===e&&e.classList.remove("open")}),r("#btnLoginGoogle").addEventListener("click",async()=>{const s=await on();s.success?(h(`Welcome, ${s.user.name}!`,"success"),await xe(),e.classList.remove("open")):h("Login failed: "+s.error,"error")}),r("#btnLogoutGoogle").addEventListener("click",async()=>{(await an()).success&&(h("Signed out","info"),await xe(),e.classList.remove("open"))}),r("#btnBackupToDrive").addEventListener("click",async()=>{e.classList.remove("open"),await at()}),r("#btnRestoreFromDriveMenu")?.addEventListener("click",async()=>{e.classList.remove("open"),await ct()}),r("#btnBackupDriveSettings")?.addEventListener("click",async()=>{p("#modalSettings"),await at()}),r("#btnRestoreDriveSettings")?.addEventListener("click",async()=>{p("#modalSettings"),await ct()}),r("#closeModalRestoreDrive")?.addEventListener("click",()=>p("#modalRestoreDrive")),r("#modalRestoreDrive")?.addEventListener("click",s=>{s.target===s.currentTarget&&p("#modalRestoreDrive")})}async function xe(){const t=r("#profileMenuLoggedOut"),e=r("#profileMenuLoggedIn"),s=r("#btnBackupDriveSettings"),n=r("#btnRestoreDriveSettings");if(await Ve()){const o=await sn();if(o){r("#userDisplayName").textContent=o.name,r("#userEmail").textContent=o.email;const a=r("#userProfilePicture");o.picture?(a.src=o.picture,a.style.display="block"):a.style.display="none";const c=r("#profileAvatar");o.picture&&(c.innerHTML=`<img src="${o.picture}" alt="Profile" />`)}t.style.display="none",e.style.display="block",s&&(s.style.display="flex"),n&&(n.style.display="flex")}else t.style.display="block",e.style.display="none",s&&(s.style.display="none"),n&&(n.style.display="none"),r("#profileAvatar").innerHTML=`
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="12" cy="7" r="4"/>
      </svg>
    `}async function at(){if(!await Ve()){h("Please sign in with Google first","error");return}h("Backing up to Drive...","info");const t=await dn(y);t.success?h(`Backup saved: ${t.fileName}`,"success",3e3):h("Backup failed: "+t.error,"error")}async function ct(){if(!await Ve()){h("Please sign in with Google first","error");return}I("#modalRestoreDrive"),r("#restoreDriveLoading").style.display="block",r("#restoreDriveEmpty").style.display="none",r("#restoreDriveList").style.display="none",r("#restoreDriveError").style.display="none",r("#restoreDriveFiles").innerHTML="";const t=await un(10);if(r("#restoreDriveLoading").style.display="none",!t.success){r("#restoreDriveError").textContent="Failed to load backups: "+t.error,r("#restoreDriveError").style.display="block";return}const e=t.files;if(!e||e.length===0){r("#restoreDriveEmpty").style.display="block";return}r("#restoreDriveList").style.display="block";const s=r("#restoreDriveFiles");e.forEach(n=>{const i=new Date(n.createdTime).toLocaleString("id-ID",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),o=n.size?`(${(parseInt(n.size)/1024).toFixed(1)} KB)`:"",a=document.createElement("div");a.className="restore-file-item",a.innerHTML=`
      <div class="restore-file-icon">üì¶</div>
      <div class="restore-file-info">
        <div class="restore-file-name">${n.name}</div>
        <div class="restore-file-date">${i} ${o}</div>
      </div>
      <div class="restore-file-actions">
        <button class="restore-btn restore-btn-restore" title="Restore this backup">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;">
            <polyline points="17 8 12 3 7 8"/>
            <line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
        </button>
        <button class="restore-btn restore-btn-delete" title="Delete this backup">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/>
          </svg>
        </button>
      </div>
    `,a.querySelector(".restore-btn-restore").addEventListener("click",c=>{c.stopPropagation(),Hn(n.id,n.name)}),a.querySelector(".restore-btn-delete").addEventListener("click",c=>{c.stopPropagation(),$n(n.id,n.name,a)}),s.appendChild(a)})}async function Hn(t,e){h("Downloading backup...","info");const s=await fn(t);if(!s.success){h("Download failed: "+s.error,"error");return}p("#modalRestoreDrive");try{const n=S||await qt(),i=await Kt(s.data.accounts,n);y=await B(),C(y),p("#modalSettings"),h(`Restored ${i.imported} account(s) from Drive!`,"success")}catch(n){h("Restore failed: "+n.message,"error")}}async function $n(t,e,s){if(!confirm(`Delete backup "${e}"?`))return;h("Deleting backup...","info");const n=await hn(t);n.success?(s.style.opacity="0",s.style.transform="translateX(-20px)",setTimeout(()=>s.remove(),300),h("Backup deleted","success"),r("#restoreDriveFiles").children.length===0&&(r("#restoreDriveList").style.display="none",r("#restoreDriveEmpty").style.display="block")):h("Delete failed: "+n.error,"error")}function Tn(){r("#btnSettings").addEventListener("click",()=>{X(),I("#modalSettings")}),r("#closeModalSettings").addEventListener("click",()=>p("#modalSettings")),r("#modalSettings").addEventListener("click",t=>{t.target===t.currentTarget&&p("#modalSettings")}),r("#pinProtectionToggle").addEventListener("change",async t=>{const e=t.target.checked;if(e&&!await lt()){p("#modalSettings"),Pn();return}b.pinEnabled=e,await Ee(e),X(),h(e?"PIN protection enabled":"PIN protection disabled","info")}),r("#privacyModeToggle").addEventListener("change",async t=>{b.privacyMode=t.target.checked,await ee("privacyMode",b.privacyMode),X()}),r("#compactLayoutToggle").addEventListener("change",async t=>{b.compactLayout=t.target.checked,await ee("compactLayout",b.compactLayout),X()}),r("#closeAfterCopyToggle").addEventListener("change",async t=>{b.closeAfterCopy=t.target.checked,await ee("closeAfterCopy",b.closeAfterCopy)}),r("#autoFocusSearchToggle").addEventListener("change",async t=>{b.autoFocusSearch=t.target.checked,await ee("autoFocusSearch",b.autoFocusSearch)}),r("#autoLockSelect").addEventListener("change",async t=>{b.autoLockMinutes=parseInt(t.target.value),await ee("autoLockMinutes",b.autoLockMinutes),We()}),W("#accentColorPicker .color-swatch").forEach(t=>{t.addEventListener("click",async()=>{const e=t.dataset.color;b.accentColor=e,await ee("accentColor",e),X()})}),r("#btnLockNow").addEventListener("click",async()=>{await _t(),S=null,p("#modalSettings"),q("#viewLock"),fe&&clearInterval(fe)}),r("#btnChangePIN").addEventListener("click",()=>{r("#currentPin").value="",r("#newPin").value="",r("#confirmNewPin").value="",r("#changePinError").classList.remove("visible"),I("#modalChangePin")}),r("#closeModalChangePin").addEventListener("click",()=>p("#modalChangePin")),r("#btnChangePinConfirm").addEventListener("click",async()=>{const t=r("#currentPin").value,e=r("#newPin").value,s=r("#confirmNewPin").value,n=r("#changePinError");if(e.length<4){n.textContent="PIN must be at least 4 digits",n.classList.add("visible");return}if(e!==s){n.textContent="New PINs do not match",n.classList.add("visible");return}try{const i=await Y("pinData");if(!await dt(t,i.hash,i.salt)){n.textContent="Current PIN is incorrect",n.classList.add("visible");return}const a=await ut(),c=await _e(e);if(await Q("pinData",c),a){const l=JSON.stringify(a),f=await ft(l,e);await Q("vault",f)}S=e,p("#modalChangePin"),h("PIN updated successfully!","success")}catch(i){n.textContent="Failed: "+i.message,n.classList.add("visible")}}),r("#btnExportData").addEventListener("click",async()=>{try{const t=await Rt(),e=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(e),n=document.createElement("a");n.href=s,n.download=`azkura-backup-${new Date().toISOString().slice(0,10)}.json`,n.click(),URL.revokeObjectURL(s),h("Backup exported!","success")}catch(t){h("Export failed: "+t.message,"error")}}),r("#importFileInput").addEventListener("change",async t=>{if(j=t.target.files[0],!!j){try{const e=await j.text(),s=JSON.parse(e);if(s.accounts&&!s.encrypted){const n=await Ot(e,S);y=await B(),C(y),p("#modalSettings"),h(`Imported ${n.imported} account(s)!`,"success"),j=null}else s.encrypted?(r("#importPassword").value="",r("#importPasswordError").classList.remove("visible"),r("#importFileInfo").textContent=`File: ${j.name}. This backup is encrypted. Enter the password.`,I("#modalImportPassword")):h("Invalid backup file format","error")}catch(e){h("Failed to read file: "+e.message,"error")}t.target.value=""}}),r("#closeModalImport").addEventListener("click",()=>p("#modalImportPassword")),r("#btnImportConfirm").addEventListener("click",async()=>{if(!j)return;const t=r("#importPassword").value,e=r("#importPasswordError");if(!t){e.textContent="Please enter the backup password",e.classList.add("visible");return}try{r("#btnImportConfirm").disabled=!0;const s=await j.text(),n=await Gt(s,t,S);y=await B(),C(y),p("#modalImportPassword"),p("#modalSettings"),h(`Imported ${n.imported} account(s)!`,"success"),j=null}catch(s){e.textContent=s.message,e.classList.add("visible")}finally{r("#btnImportConfirm").disabled=!1}}),r("#btnDeleteAll").addEventListener("click",()=>{r("#deleteAllConfirmInput").value="",r("#btnDeleteAllConfirm").disabled=!0,I("#modalDeleteAll")}),r("#btnDeleteAllCancel").addEventListener("click",()=>p("#modalDeleteAll")),r("#deleteAllConfirmInput").addEventListener("input",t=>{r("#btnDeleteAllConfirm").disabled=t.target.value!=="DELETE"}),r("#btnDeleteAllConfirm").addEventListener("click",async()=>{if(r("#deleteAllConfirmInput").value==="DELETE")try{await zt(),y=[],S=null,p("#modalDeleteAll"),p("#modalSettings"),h("All data deleted","info",2e3),setTimeout(()=>{q("#viewOnboarding"),St()},500)}catch(t){h("Failed to delete: "+t.message,"error")}})}async function Pn(){r("#currentPin").closest(".form-group").style.display="none",r("#newPin").placeholder="Create PIN",r("#confirmNewPin").placeholder="Confirm PIN",r("#changePinError").classList.remove("visible"),r("#btnChangePinConfirm").onclick,r("#btnChangePinConfirm").onclick=async()=>{const t=r("#newPin").value,e=r("#confirmNewPin").value,s=r("#changePinError");if(t.length<4){s.textContent="PIN must be at least 4 digits",s.classList.add("visible");return}if(t!==e){s.textContent="PINs do not match",s.classList.add("visible");return}try{const n=await _e(t);await Q("pinData",n),await Ee(!0),b.pinEnabled=!0,S=t;const i=await ut();if(i){const o=JSON.stringify(i),a=await ft(o,t);await Q("vault",a)}p("#modalChangePin"),h("PIN protection enabled!","success"),X(),setTimeout(()=>{r("#currentPin").closest(".form-group").style.display="block",r("#newPin").placeholder="",r("#confirmNewPin").placeholder=""},300)}catch(n){s.textContent="Failed: "+n.message,s.classList.add("visible")}},I("#modalChangePin")}function Fn(){W(".folder-chip[data-folder]").forEach(t=>{t.addEventListener("click",()=>{W(".folder-chip[data-folder]").forEach(e=>e.classList.remove("active")),t.classList.add("active"),J=t.dataset.folder,C(y)})}),r("#btnManageFolders").addEventListener("click",()=>{Mn()}),r("#closeModalFolders").addEventListener("click",()=>p("#modalManageFolders")),r("#closeModalMoveFolder").addEventListener("click",()=>p("#modalMoveToFolder")),r("#modalManageFolders").addEventListener("click",t=>{t.target===t.currentTarget&&p("#modalManageFolders")}),r("#modalMoveToFolder").addEventListener("click",t=>{t.target===t.currentTarget&&p("#modalMoveToFolder")}),r("#btnCreateFolder").addEventListener("click",async()=>{const t=r("#newFolderName").value.trim();if(!t){h("Please enter a folder name","error");return}const e=r("#folderColorPicker .color-swatch.active"),s=e?e.dataset.color:"#00E5FF";await Vt(t,s),r("#newFolderName").value="",await Dt(),await qe(),h("Folder created!","success")}),r("#folderColorPicker")?.addEventListener("click",t=>{t.target.classList.contains("color-swatch")&&(W("#folderColorPicker .color-swatch").forEach(e=>e.classList.remove("active")),t.target.classList.add("active"))})}async function Dt(){kt=await Re()}async function qe(){const t=r("#folderList");if(t){t.innerHTML="";for(const e of kt){const s=document.createElement("button");s.className="folder-chip",s.dataset.folder=e.id,s.innerHTML=`
      <span style="width:8px;height:8px;border-radius:50%;background:${e.color};"></span>
      ${Z(e.name)}
    `,s.addEventListener("click",()=>{W(".folder-chip[data-folder]").forEach(n=>n.classList.remove("active")),s.classList.add("active"),J=e.id,C(y)}),t.appendChild(s)}}}async function Mn(){await Ht(),I("#modalManageFolders")}async function Ht(){const t=r("#foldersList"),e=await Re();if(t.innerHTML="",e.length===0){t.innerHTML='<div style="text-align:center;color:var(--text-secondary);padding:20px;">No folders yet</div>';return}for(const s of e){const n=document.createElement("div");n.className="folder-item",n.innerHTML=`
      <div class="folder-dot" style="background:${s.color};"></div>
      <div class="folder-name">${Z(s.name)}</div>
      <div class="folder-actions">
        <button class="folder-btn delete" title="Delete folder">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px;">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/>
          </svg>
        </button>
      </div>
    `,n.querySelector(".folder-btn.delete").addEventListener("click",async()=>{confirm(`Delete folder "${s.name}"? Accounts will be uncategorized.`)&&(await Jt(s.id),await Ht(),await qe(),C(y),h("Folder deleted","info"))}),t.appendChild(n)}}async function Bn(t){const e=r("#moveFolderList"),s=await Re(),n=y.find(o=>o.id===t);e.innerHTML="";const i=document.createElement("div");i.className=`move-folder-item ${n?.folderId?"":"selected"}`,i.innerHTML=`
    <div style="width:24px;height:24px;border-radius:50%;background:var(--border-medium);display:flex;align-items:center;justify-content:center;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px;">
        <path d="M3 7v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2h-6l-2-2H5a2 2 0 0 0-2 2z"/>
      </svg>
    </div>
    <div style="flex:1;">Uncategorized</div>
  `,i.addEventListener("click",async()=>{await Xe(t,null),y=await B(),C(y),p("#modalMoveToFolder"),h("Account moved","success")}),e.appendChild(i);for(const o of s){const a=document.createElement("div");a.className=`move-folder-item ${n?.folderId===o.id?"selected":""}`,a.innerHTML=`
      <div style="width:24px;height:24px;border-radius:50%;background:${o.color};"></div>
      <div style="flex:1;">${Z(o.name)}</div>
    `,a.addEventListener("click",async()=>{await Xe(t,o.id),y=await B(),C(y),p("#modalMoveToFolder"),h("Account moved","success")}),e.appendChild(a)}I("#modalMoveToFolder")}async function Un(){St(),pn(),xn(),Ln(),An(),Sn(),In(),Tn(),Dn(),Fn();const t=await Tt(),e=await lt(),s=await Pt(),n=await Ft();t?q("#viewOnboarding"):e&&s&&!n?q("#viewLock"):(S=null,n||await Le(null),q("#viewMain"),await Se(),s&&We()),chrome.storage.session.get("pendingQR",async i=>{if(i.pendingQR){chrome.storage.session.remove("pendingQR");const o=Xt(i.pendingQR);En(o),I("#modalAddAccount")}})}Un().catch(console.error);
