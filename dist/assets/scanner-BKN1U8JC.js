import"./modulepreload-polyfill-B5Qt9EMX.js";const n=document.getElementById("video"),r=document.getElementById("canvas"),e=document.getElementById("statusText"),l=document.getElementById("permissionError"),m=document.getElementById("videoWrapper");let a=null,i=!1;window.startScanner=c;async function c(){l.classList.remove("visible"),e.textContent="Initializing camera...";try{a=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:1280},height:{ideal:720}}}),n.srcObject=a,await n.play(),i=!0,e.textContent="Scanning for QR code...",requestAnimationFrame(s)}catch(t){t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?(e.textContent="",l.classList.add("visible"),m.style.display="none"):(e.textContent="Camera error: "+t.message,e.className="status-text error")}}async function s(){if(!i)return;if(n.readyState<n.HAVE_ENOUGH_DATA){requestAnimationFrame(s);return}r.width=n.videoWidth,r.height=n.videoHeight,r.getContext("2d").drawImage(n,0,0);let o=null;if("BarcodeDetector"in window)try{const d=await new BarcodeDetector({formats:["qr_code"]}).detect(n);d.length>0&&(o=d[0].rawValue)}catch{}if(o){u(o);return}requestAnimationFrame(s)}function u(t){if(i=!1,a&&(a.getTracks().forEach(o=>o.stop()),a=null),e.textContent="✓ QR Code detected!",e.className="status-text success",!t.startsWith("otpauth://")){e.textContent="⚠ QR code found, but not a valid TOTP code",e.className="status-text error",setTimeout(c,2e3);return}chrome.runtime.sendMessage({type:"QR_SCANNED",data:t}),e.textContent="✓ Account added! You can close this tab.",setTimeout(()=>window.close(),1500)}c();window.addEventListener("beforeunload",()=>{a&&a.getTracks().forEach(t=>t.stop())});
