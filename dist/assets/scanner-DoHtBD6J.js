import"./modulepreload-polyfill-B5Qt9EMX.js";const _="modulepreload",B=function(t){return"/"+t},x={},C=function(e,a,r){let u=Promise.resolve();if(a&&a.length>0){let y=function(o){return Promise.all(o.map(h=>Promise.resolve(h).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),s=n?.nonce||n?.getAttribute("nonce");u=y(a.map(o=>{if(o=B(o),o in x)return;x[o]=!0;const h=o.endsWith(".css"),v=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${v}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":_,h||(m.as="script"),m.crossOrigin="",m.href=o,s&&m.setAttribute("nonce",s),document.head.appendChild(m),h)return new Promise((k,S)=>{m.addEventListener("load",k),m.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${o}`)))})}))}function g(n){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=n,window.dispatchEvent(s),!s.defaultPrevented)throw n}return u.then(n=>{for(const s of n||[])s.status==="rejected"&&g(s.reason);return e().catch(g)})},f=document.getElementById("video"),p=document.getElementById("canvas"),i=document.getElementById("statusTextCamera"),c=document.getElementById("statusTextUpload"),A=document.getElementById("permissionError"),b=document.getElementById("videoWrapper"),I=document.getElementById("fileInput"),d=document.getElementById("uploadArea");let l=null,w=!1;window.switchTab=function(t){document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(e=>e.classList.remove("active")),document.getElementById(`tab${t.charAt(0).toUpperCase()+t.slice(1)}`).classList.add("active"),document.getElementById(`content${t.charAt(0).toUpperCase()+t.slice(1)}`).classList.add("active"),t!=="camera"&&l&&(l.getTracks().forEach(e=>e.stop()),l=null,w=!1),t==="camera"&&!l&&startScanner()};window.startScanner=async function(){A.classList.remove("visible"),b.style.display="block",i.textContent="Initializing camera...";try{l=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:1280},height:{ideal:720}}}),f.srcObject=l,await f.play(),w=!0,i.textContent="Scanning for QR code...",requestAnimationFrame(E)}catch(t){t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?(i.textContent="",b.style.display="none",A.classList.add("visible")):(i.textContent="Camera error: "+t.message,i.className="status-text error")}};async function E(){if(!w)return;if(f.readyState<f.HAVE_ENOUGH_DATA){requestAnimationFrame(E);return}p.width=f.videoWidth,p.height=f.videoHeight,p.getContext("2d").drawImage(f,0,0);let e=null;if("BarcodeDetector"in window)try{const r=await new BarcodeDetector({formats:["qr_code"]}).detect(f);r.length>0&&(e=r[0].rawValue)}catch{}if(e){T(e,"camera");return}requestAnimationFrame(E)}d.addEventListener("click",()=>I.click());d.addEventListener("dragover",t=>{t.preventDefault(),d.style.borderColor="var(--accent)",d.style.background="rgba(0,229,255,0.1)"});d.addEventListener("dragleave",()=>{d.style.borderColor="",d.style.background=""});d.addEventListener("drop",t=>{t.preventDefault(),d.style.borderColor="",d.style.background="";const e=t.dataTransfer.files[0];e&&e.type.startsWith("image/")&&L(e)});I.addEventListener("change",t=>{const e=t.target.files[0];e&&L(e)});async function L(t){c.textContent="Processing image...",c.className="status-text";try{const e=new Image,a=URL.createObjectURL(t);e.src=a,await new Promise((g,n)=>{e.onload=g,e.onerror=()=>n(new Error("Failed to load image"))}),p.width=e.naturalWidth,p.height=e.naturalHeight,p.getContext("2d").drawImage(e,0,0),URL.revokeObjectURL(a);let u=null;if("BarcodeDetector"in window)try{const n=await new BarcodeDetector({formats:["qr_code"]}).detect(e);n.length>0&&(u=n[0].rawValue)}catch{}u?T(u,"upload"):(c.textContent="⚠ No QR code found in image",c.className="status-text error")}catch(e){c.textContent="Error: "+e.message,c.className="status-text error"}}async function T(t,e){if(w=!1,l&&(l.getTracks().forEach(a=>a.stop()),l=null),!t.startsWith("otpauth://")){const a="⚠ QR code found, but not a valid TOTP code";e==="camera"?(i.textContent=a,i.className="status-text error",setTimeout(startScanner,2e3)):(c.textContent=a,c.className="status-text error");return}try{const{parseOtpauthURI:a}=await C(async()=>{const{parseOtpauthURI:s}=await import("./uri-parser-CbsR1lsV.js");return{parseOtpauthURI:s}},[]),r=a(t);if(!r||!r.secret)throw new Error("Invalid TOTP data");const{addAccount:u,getDefaultKey:g}=await C(async()=>{const{addAccount:s,getDefaultKey:y}=await import("./accounts-YaHucQfM.js").then(o=>o.G);return{addAccount:s,getDefaultKey:y}},[]),n=await g();await u({issuer:r.issuer||"",account:r.account||"",secret:r.secret,algorithm:r.algorithm||"SHA1",digits:r.digits||6,period:r.period||30},n),e==="camera"?(i.textContent="✓ Account added! Closing...",i.className="status-text success"):(c.textContent="✓ Account added! Closing...",c.className="status-text success"),setTimeout(()=>{alert("✅ Akun berhasil ditambahkan!"),window.close()},500)}catch(a){console.error("Failed to add account:",a),chrome.runtime.sendMessage({type:"QR_SCANNED",data:t}),e==="camera"?(i.textContent="✓ Account saved! Closing...",i.className="status-text success"):(c.textContent="✓ Account saved! Closing...",c.className="status-text success"),setTimeout(()=>{alert("✅ Akun berhasil ditambahkan!"),window.close()},500)}}const D=new URLSearchParams(window.location.search),P=D.get("tab");P==="upload"?switchTab("upload"):document.getElementById("contentCamera").classList.contains("active")&&startScanner();window.addEventListener("beforeunload",()=>{l&&l.getTracks().forEach(t=>t.stop())});
